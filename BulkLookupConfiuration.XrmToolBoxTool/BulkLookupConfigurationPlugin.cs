using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace BulkLookupConfiguration.XrmToolBoxTool
{
    // Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
    // To generate Base64 string for Images below, you can use https://www.base64-image.de/
    [
        Export(typeof(IXrmToolBoxPlugin)),
        ExportMetadata("Name", "Lookup Experience Manager"),
        ExportMetadata("Description", "This plugin bulk updates lookup controls so that its inline \"New\" button, \"Most Recently Used\", and \"Use Main Form Dialog For (Create/Edit)\" configuration options can be toggled on/off."),
        // Please specify the base64 content of a 32x32 pixels image
        ExportMetadata("SmallImageBase64", "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAHNElEQVR4AcSWCVRU1xnH/w9mg2FYAlMNEis2LkD0iBbRgGIrxBMhKC1gQBFBVIoKitEUbDAhYMAtbhVZCjqAOkIEBJVggAQtWBHEaAARqGyyzbDMysDMvL7nOeTUU5I6Rtp7zv+9++79lt/57n33XD38n9vPAgyT6oLbPa1kUulVMibpBPn52VNkUsEl8puGWrJhoJN8HewTAohI5abr1bdJj8B1nu6b/HCi8DKKxS24NtiK5Jpv4XNgL5wCfLHpUAxZN/DsF4H8B0APOTIYGrMvIyRmL2xd3sWOyEh4eq3F4mXOmLVgHpxcXLB99y5sDN+BJqkYS73dkV1TQVKNeJWKvADQLROTq4P9TBvlYgTF74fMiIEbBYXITjyN/KOpqM0sQtmpLKTGHoVoaBjvrnkf/nt2Yv3OrThZINT+IgCFWuEdvj8KemZG8A4KwNclJfgq6yI8XVyRm5KBuwUlyE8X4HqmECkJx/C+8wroaanqM/QQlRiHmMR4lDV8v0hXiB8rUFxVmVP9pBHu63xQkJsPRcM/cStDiHCfAEy34EOlVYDJ0gPPiAuH+fOwZKo1bDnmEPw1BVKJHL7BGxEc8ad7rwQwTJLh0Ye/gKe/L/qf9aC5+gEunUjGTENTGMoVMB5Vw5RCNSI1gHQQXIUKZtTYStsF+ChoG/KEObB+Zy5IYwNcLCmx1AWCCgs0dbWd6BqR4Q2raagqKsVnW8Ix3YQPlmoMqtZOsHvEMJIqYEZ9mw0rwKAgNb194FEQwe5eYI6o0dzVjhVrVuNMVqpQZ4CSslLYLV0MDYuBxuo6fPieB9SDErTd/wF9dY/QR1VE9kMT9AakEFHzvVW1ED+oh6a7HxZgYP2aP6Kqphrmv56G1o42Z50Burq7weVboE3UAzsbW5gQHJgTTAzUt2AKyYSZnKoE1W+/WgJz2SilMZgOKMDqHgR7WAX337uhpa0dBJuNgaEhXfLj+RJIhyVgGXKgJvRgSG0ylXoM6jEtjHk8DPeLYUgSMNdnYyrHCJArYcRmgUm5asfUMOBwIBKJQJ0D4FB9giB0B5jOnwKFVAIul4um9naMUrtdziHwpt0sjOiTUJFqKEdUUKhHMcZhoZ/ajENcJoznzISE6stGRqCvrw+otTBgsnQHsJk7G22NT8BjG0AyqkSvSg4FE7CYPQPGv7HC0yExNNT/DgYDQ4QGEi4DU+znQcZjQ8PjouTWt1i4wB4Sqlo8DrcdOjQ92tbR0bGju74Zpiw25iycj1PZGVCxGJDoafErp0WYuvgdDCoVGJKPQGNughnLl0BtaY4Btj7qxZ0QXLmM5U7OaGl4jBXOzlfomC+r5wBvm/GtVyx0QOXNcnh4fYC0iwLcrK6EksuG1JAJk/k2sF7lhmm/tce0xQ4YNTGGhAKUUVWKPhoHp/d+B1KpQWl+sfpc/JHdL5ucttOjHwRBaGL3/RlVpeWQKeUI3BWGsAPRyLh5DV3aMSjNLaAw44FhNxcSAw4UBgboHBpA8O7teCrrhpPrMty6Vgb3JSvP0/F00XMA2sHxTWtiz5ZtSD12HGZcLkJ3bsfh5CRsiIzAl/lCVIi7UNzxGMXNDxFxKBYegf5gmZrAz9cPDTV1qMy/gZXzHcvpWLroRwDa6ZN1wfof+W9GRvwxsKlTblvoFtgud0B25ddYnxAF34P7sDMpAT1GJD6MDIWLmyvuX/8HHuSWofxCNnLOHo/IOJO2lo71snoBgFoK7aeBoUTmkVMffJVyHoVZQnAZLLi6umLDpkDs2hOJoKAgzJo+Ay0P6/FlTBxG2vtvcGRjj4yhRebZ0w4XBWkfnzyUsPGVAMadPB2XFT0tvkXUny8gqvOKb19OPK24knBSJPjLF12CqLjOb06m11mJRmPlpXeJiuzs1QcPxq0M2Rx8b4C6oFy4cm5JiiD56CexsWHj8X7u/UIFJjKsuVS4rKfsLrez+O/89usVVt3f3XurtbTS/m/xhw+M2/9h1aq++48aHULCtt45k5ECrrmJRdWD2oQd0Z/Gjdv81Pu/AvyU40Tj1bVPlh5LSmsJCY/AZwkHePUt30dviYxKI0lSfyJ7euy1AtABhzolbycmHL5TXnYTo6MDxP26ks1bw4NKKYgJz+jXDkBDNFfXL00+crx+Kk8fwqw4kJpml8jtfipSKuXT8/+uSQGgE3Q8eWbX1vD44dXcCzj0+X4wCSUC1q/tI2WSBHp+XJMGQCcoEt5wK8ypwKXz+dgfFQo7mzcQ5OfzsbRblEPP05pUgCkz5/VmCUv4hUXfITU1HWGhIVhkPxubA7y9B/t7OyYdgE5gaTlHlCrIs7hztx3p53Lhv8EDbqvs4eO11komGds7qRWgAWhZWdmIkwRFxlXVDUgXZGGNlydIaKibVE/i/wSAhuDz+VJh2mVuw2MJAjbuAdfUEFPeMmyadAA6+bgIS0tFek4BkZWZMyevIG+3AdN87r8AAAD//3JS37YAAAAGSURBVAMArUIEkgAQxHQAAAAASUVORK5CYII="),
        // Please specify the base64 content of a 80x80 pixels image
        ExportMetadata("BigImageBase64", "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"),
        ExportMetadata("BackgroundColor", "#E0FEFE"),
        ExportMetadata("PrimaryFontColor", "#0D7680"),
        ExportMetadata("SecondaryFontColor", "#555555"),
        ExportMetadata("AccentColor", "#4ECDC4"),

        ExportMetadata("Group", "Lookup | Form Tools | Customizations XML")
    ]
    public class BulkLookupConfigurationPlugin : PluginBase
    {
        public override IXrmToolBoxPluginControl GetControl()
        {
            return new BulkLookupConfigurationControl();
        }

        /// <summary>
        /// Constructor 
        /// </summary>
        public BulkLookupConfigurationPlugin()
        {
            // If you have external assemblies that you need to load, uncomment the following to 
            // hook into the event that will fire when an Assembly fails to resolve
            // AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
        }

        /// <summary>
        /// Event fired by CLR when an assembly reference fails to load
        /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
        /// For example, a folder named Sample.XrmToolBox.MyPlugin 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="args"></param>
        /// <returns></returns>
        private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
        {
            Assembly loadAssembly = null;
            Assembly currAssembly = Assembly.GetExecutingAssembly();

            // base name of the assembly that failed to resolve
            var argName = args.Name.Substring(0, args.Name.IndexOf(","));

            // check to see if the failing assembly is one that we reference.
            List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
            var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

            // if the current unresolved assembly is referenced by our plugin, attempt to load
            if (refAssembly != null)
            {
                // load from the path to this plugin assembly, not host executable
                string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
                string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
                dir = Path.Combine(dir, folder);

                var assmbPath = Path.Combine(dir, $"{argName}.dll");

                if (File.Exists(assmbPath))
                {
                    loadAssembly = Assembly.LoadFrom(assmbPath);
                }
                else
                {
                    throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
                }
            }

            return loadAssembly;
        }
    }
}